# -*- python -*-
Import('env')

env.Program("citizen", ["citizen.cc"], LIBS="fw")
env.Program(["generate.cc"],
	    LIBS=["fw"] + env.libs["vw"] + \
            Split("vwMosaic vwImage") + env.libs["boost"])
env.Program(["vwconvert.cc"], LIBS=env.libs["vw"])
env.Program(["fitsio.cc"], LIBS=["fw"] + env.libs["vw"] + env.libs["fits"])
env.Program(["exceptions.cc"], LIBS="fw")
env.Program("log", ["log.cc"], LIBS="fw")
env.Program("trace", ["trace.cc"], LIBS="fw")

#
# Tests
#
import glob, os, sys

import lsst.tests
tests = lsst.tests.Control(env, ignoreList=["fitsio", "generate", "vwconvert"])

try:
    tests.runExamples                   # in scons 1.16
    tests.run("*.cc")
    tests.run("*.py")
except:                                 # Code for pre-1.16 scons
    tests.runExamples = True            # should I run the examples?
    try:
        runExamples = (os.stat(tests._tmpDir).st_mode & 0x5) # file is world read/executable
    except OSError:
        pass

    if not runExamples:
        print >> sys.stderr, "Not running examples; \"chmod 755 %s\" to run them again" % tests._tmpDir
    else:
        tests.run("*.cc")
        tests.run("*.py")


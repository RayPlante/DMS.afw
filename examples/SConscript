# -*- python -*-
Import('env')

env.Program("citizen", ["citizen.cc"], LIBS=["fw"] + env.libs["wcs"])
env.Program(["generate.cc"],
	    LIBS=["fw"] + env.libs["wcs"] + env.libs["vw"] + \
            Split("vwMosaic vwImage") + env.libs["boost"])
env.Program(["vwconvert.cc"], LIBS=env.libs["vw"])
env.Program(["fitsio.cc"], LIBS=["fw"] + env.libs["vw"] + env.libs["fits"] + env.libs["wcs"])
env.Program("maskedImageFitsIO", ["maskedImageFitsIO.cc"],
    LIBS=["fw"] + env.libs["vw"] + env.libs["fits"] + ["vwImage"] + env.libs["boost"])
env.Program(["exceptions.cc"], LIBS=["fw"]+ env.libs["wcs"])
env.Program("log", ["log.cc"], LIBS=["fw"]+ env.libs["wcs"])
env.Program("trace", ["trace.cc"], LIBS=["fw"]+ env.libs["wcs"])

env.Program("chebyshev1Function", ["chebyshev1Function.cc"],
    LIBS=["fw"] + env.libs["boost"])
env.Program("gaussianFunction", ["gaussianFunction.cc"],
    LIBS=["fw"] + env.libs["boost"])
env.Program("integerDeltaFunction", ["integerDeltaFunction.cc"],
    LIBS=["fw"] + env.libs["boost"])
env.Program("lanczosFunction", ["lanczosFunction.cc"],
    LIBS=["fw"] + env.libs["boost"])
env.Program("polynomialFunction", ["polynomialFunction.cc"],
    LIBS=["fw"] + env.libs["boost"])

env.Program("analyticKernel", ["analyticKernel.cc"],
    LIBS=["fw"] + env.libs["vw"] + ["vwImage"] + env.libs["boost"])
env.Program("deltaFunctionKernels", ["deltaFunctionKernels.cc"],
    LIBS=["fw"] + env.libs["vw"] + ["vwImage"] + env.libs["boost"])
env.Program("fixedKernel", ["fixedKernel.cc"],
    LIBS=["fw"] + env.libs["vw"] + ["vwImage"] + env.libs["boost"])
env.Program("lanczosKernel", ["lanczosKernel.cc"],
    LIBS=["fw"] + env.libs["vw"] + ["vwImage"] + env.libs["boost"])

env.Program("simpleConvolve", ["simpleConvolve.cc"],
    LIBS=["fw"] + env.libs["vw"] + env.libs["fits"] + ["vwImage"] + env.libs["boost"])
env.Program("spatiallyVaryingConvolve", ["spatiallyVaryingConvolve.cc"],
    LIBS=["fw"] + env.libs["vw"] + env.libs["fits"] + ["vwImage"] + env.libs["boost"])
env.Program("timeConvolve", ["timeConvolve.cc"],
    LIBS=["fw"] + env.libs["vw"] + env.libs["fits"] + ["vwImage"] + env.libs["boost"])
env.Program("timeSpatiallyVaryingConvolve", ["timeSpatiallyVaryingConvolve.cc"],
    LIBS=["fw"] + env.libs["vw"] + env.libs["fits"] + ["vwImage"] + env.libs["boost"])
#
# Tests
#
import glob, os, sys

import lsst.tests
tests = lsst.tests.Control(env, ignoreList=[
    "fitsio", "generate", "vwconvert", "maskedImageFitsIO",
    "simpleConvolve", "spatiallyVaryingConvolve", "timeConvolve", "timeSpatiallyVaryingConvolve",
])

if not hasattr(tests, "runExamples"): # before scons 1.16
    try:
        tests.runExamples = (os.stat(tests._tmpDir).st_mode & 0x1) # directory is world executable
    except OSError:
        tests.runExamples = True

if not tests.runExamples:
    print >> sys.stderr, "Not running the examples; \"chmod o+x examples/%s\" to run them" % tests._tmpDir
else:
    print >> sys.stderr, "Running the examples; \"chmod o-x examples/%s\" to not run them" % tests._tmpDir
    tests.run("*.cc")
    tests.run("*.py")
